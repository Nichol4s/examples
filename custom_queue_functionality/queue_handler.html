<!DOCTYPE html>
<html>
	<head>
		<title>Custom Javascript handler - Surfly Examples</title>
		<link rel="stylesheet" href="../style.css">
		<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
	</head>
	<body>
		<header>
			<a href=" https://www.surfly.com/ ">
				<img alt="Delicious Mint" src="https://www.surfly.com/wp-content/themes/delicious/img/mint/logo.png">
			</a>
		</header>
		<div class="main_container">
			<h1>Example : Custom Javascript handler</h1>
			<div class="back_navigation">
				<a href="/examples/">Back to listing</a>
			</div>
			<p>Manage queue by your own code. Add your custom functionality <b>QUEUE_HANDLER</b></p>

			<p>Open this Custom queue handler dashboard in new browser <b>http://surfly.github.io/examples/custom_queue_functionality/queue_handler_dashboard.html</b></p>
			<br>
			<p>
				In Custom queue handler dashboard have list all our session queue. If we want to track our cancelled session we can use <b>QUEUE_CALLBACK</b>. It will trigger when joined success in queue or session is cancelled.
			</p>

			<p><b>API Ref</b> : <a href="http://docs.surfly.apiary.io/#introduction/customizing-the-user-flow/change-queue-behaviour" target="_blank"> Surfly Api document</a></p>

			<div class="source_link">
				<p><b>Source code</b> : <a href="https://github.com/surfly/examples/blob/gh-pages/custom_queue_functionality/queue_handler.html" target="_blank"> Github</a></p>
			</div>
		</div>

		<script type="text/javascript">
			/*
				To manage our queue with QUEUE_HANDLER
				1. Used Firebase for store session data
			*/

			d = new Date();
			var myDataRef = new Firebase('https://surflydev.firebaseio.com/'+d.getDate()+'-'+ (d.getMonth() + 1) +'-'+d.getFullYear());

			//This is my custom handler function

			function custom_queue_handler(data, cb)
			{
				data.status = true;
				postdata = myDataRef.push(data);
				firebase_session_id = postdata.key();
				cb(firebase_session_id);
			}

			/*
			This is my custom callback function
			if we want to trace session cancelled or closed use CUSTOM_CALLBACK
			If no need to trace leave it as false
			
			CUSTOM_CALLBACK have two param
			1. status true or false
				true - success queue join, rejoin
				false - cancel, reload, closed
			2. success callback data
			*/
			function custom_callback(status, data)
			{
				var child_data = myDataRef.child(data);
				    child_data.update({
				      "status": status
				});
			}

			(function(){window['_surfly_settings']=window['_surfly_settings']||{"widgetkey": "54731063bfa746ac826d1429f230a0b7",
				"enable_sounds": true,
				"videochat": true,
				"QUEUE_CALLBACK": custom_callback,
				"min_width": 0,
				"agent_can_request_control": false,
				"on_end_redirect_follower_to_queue": true,
				"dock_top_position": false,
				"autohide_control": false,
				"splash": false,
				"theme_font_size": false,
				"hidden": false,
				"theme_font_color": false,
				"set_to_smallest": true,
				"newurl": true,
				"QUEUE_ENDPOINT": "",
				"agent_can_take_control": false,
				"max_height": 0,
				"white_label": false,
				"min_height": 0,
				"theme_inverted": true,
				"QUEUE_HANDLER": custom_queue_handler, //called my custom function
				"autohide_button": true,
				"soft_session_end": false,
				"docked_only": false,
				"theme_font_background": false,
				"ui_off": false,
				"max_width": 0,
				"apiserver": "https://surfly.com/v2/",
				"sharing_button": true,
				"auto_start": false,
				"position": "bottomleft",
				"stealth_mode": true};
				var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src="//surfly.com/static/js/widget.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n); 
			})();
		</script>
	</body>
</html>